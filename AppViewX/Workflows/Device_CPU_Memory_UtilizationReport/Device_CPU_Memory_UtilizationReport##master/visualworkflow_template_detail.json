[ {
  "tasks" : [ {
    "uniqueId" : null,
    "directoryUniqueId" : null,
    "source" : null,
    "tags" : [ ],
    "userName" : null,
    "objectType" : "TaskDetails",
    "sourceControlSettings" : null,
    "description" : null,
    "historyReferences" : [ "5d5e491559d3b8006a2f0d65", "5d5e470e59d3b8006a2f0d43" ],
    "usedHistory" : "8e7cb90a5614c6de49891764fc4da86a",
    "sampleInput" : null,
    "sampleOutput" : null,
    "contentTab" : null,
    "successiveTasks" : {
      "incoming" : [ {
        "taskId" : "cpu_tmm_check_1",
        "taskName" : null,
        "subflowId" : "YObl0e4R",
        "parentSubflowId" : "",
        "taskType" : "start",
        "flowName" : null,
        "linkType" : null,
        "backwardLink" : false
      } ]
    },
    "flowPathID" : null,
    "ignoredForStatusComputation" : true,
    "flowName" : null,
    "subFlowID" : null,
    "globalData" : null,
    "input" : [ ],
    "notificationMessage" : null,
    "ancestor" : null,
    "metaData" : {
      "taskHeader" : "stop",
      "hide" : false,
      "lock" : false,
      "successState" : 1,
      "failoverState" : 2,
      "taskScope" : null,
      "hideFromStageView" : false,
      "mode" : "Developer",
      "nature" : null,
      "lowCodeTask" : false
    },
    "parentSubFlowID" : null,
    "helpContent" : null,
    "rules" : { },
    "cleanUpFlowDetails" : { },
    "subFlowDetails" : [ ],
    "associatedRollbackWorkOrderDetail" : null,
    "_id" : null,
    "task_id" : "workflow_stop_1",
    "task_name" : "Stop",
    "task_type" : "stop",
    "task_category" : "stop",
    "component_type" : "others",
    "setNullProperties" : true,
    "folderName" : null,
    "sub_group" : null,
    "group_name" : null,
    "viewable_type" : "custom"
  }, {
    "uniqueId" : null,
    "directoryUniqueId" : null,
    "source" : null,
    "tags" : [ ],
    "userName" : null,
    "objectType" : "TaskDetails",
    "sourceControlSettings" : null,
    "description" : "Calculates CPU and TMM Memory in % irrespective of Version for F5 devices only",
    "historyReferences" : [ "5d5e495459d3b8006a2f0d6e", "5d5e491359d3b8006a2f0d62", "5d5e491559d3b8006a2f0d64", "5d5e481559d3b8006a2f0d4d", "5d5e47ff59d3b8006a2f0d4b", "5d5e472759d3b8006a2f0d49", "5d5e48e859d3b8006a2f0d60", "5d5e48a359d3b8006a2f0d5e", "5d5e486559d3b8006a2f0d54", "5d5e489a59d3b8006a2f0d5c" ],
    "usedHistory" : "6758d9566e853d584d25c5848f1d1875",
    "sampleInput" : null,
    "sampleOutput" : null,
    "contentTab" : null,
    "successiveTasks" : {
      "incoming" : [ {
        "taskId" : "schedule_1",
        "taskName" : null,
        "subflowId" : "YObl0e4R",
        "parentSubflowId" : "",
        "taskType" : "start",
        "flowName" : null,
        "linkType" : null,
        "backwardLink" : false
      } ],
      "success" : [ {
        "taskId" : "workflow_stop_1",
        "taskName" : null,
        "subflowId" : "YObl0e4R",
        "parentSubflowId" : "",
        "taskType" : "stop",
        "flowName" : null,
        "linkType" : null,
        "backwardLink" : false
      } ]
    },
    "flowPathID" : null,
    "ignoredForStatusComputation" : false,
    "flowName" : "",
    "subFlowID" : "YObl0e4R",
    "globalData" : null,
    "input" : [ {
      "name" : null,
      "key" : "device_name",
      "value" : "<%device_name%>",
      "description" : null,
      "dataType" : "JSON",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "device_name",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    }, {
      "name" : null,
      "key" : "tmm_memory_threshold",
      "value" : null,
      "description" : null,
      "dataType" : "JSON",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "tmm_memory_threshold",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    }, {
      "name" : null,
      "key" : "cpu_memory_threshold",
      "value" : null,
      "description" : null,
      "dataType" : "JSON",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "cpu_memory_threshold",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    } ],
    "notificationMessage" : {
      "0" : "Calculating CPU and TMM...",
      "1" : "",
      "2" : "Sorry failed to get CPU and TMM"
    },
    "ancestor" : null,
    "metaData" : {
      "taskHeader" : "Check CPU and TMM",
      "hide" : false,
      "lock" : false,
      "successState" : 1,
      "failoverState" : 2,
      "taskScope" : null,
      "hideFromStageView" : false,
      "mode" : "Developer",
      "nature" : "normal",
      "lowCodeTask" : false
    },
    "parentSubFlowID" : "",
    "helpContent" : null,
    "name" : "",
    "syncExecution" : true,
    "_id" : null,
    "task_id" : "cpu_tmm_check_1",
    "task_name" : "Check CPU and TMM",
    "task_type" : "script",
    "task_category" : "script",
    "component_type" : "others",
    "setNullProperties" : true,
    "folderName" : "General",
    "sub_group" : null,
    "group_name" : null,
    "viewable_type" : "custom",
    "scriptType" : "Python",
    "scriptContent" : "import paramiko\nimport sys\nimport os\nimport json\n\nsys.path.append(AVX::HELPER)\nsys.path.append(AVX::DEPENDENCIES)\n\nimport appviewx\nimport Decrypt_Python3 as Decrypt\nfrom Decrypt_Python3 import getpassword, getencoded\n\n'''custom data'''\ndevice='<%device_name%>' #replaced if variable is matched to the declared global data\n\n# cpu_memory_threshold = int('<%cpu_memory_threshold%>')\n# tmm_memory_threshold = int('<%tmm_memory_threshold%>')\n\n\ndb=appviewx.db_connection().appviewx.device\ndeviceip = db.find({'name':device})[0]['ip']\nuname, pwrd = Decrypt.getpassword(device)\n\ndef connect_remote(IP,Username,Password):\n\n\t'''establishing remote connection'''\n\t\n\ttry:\n\t\tssh = paramiko.SSHClient()\n\t\tssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())\n\t\tssh.connect(IP, username=Username, password=Password, port=22)\n\t\treturn ssh\n\texcept Exception as e:\n\t\tAVX::LOG (str(e))\n\ndef check_bash_mode(connection) :\n\n\t'''verifying for bash mode '''\n\n\tstdin, stdout, err=connection.exec_command('echo \"testing\"')\n\terr = err.read().decode()\n\tif \"Error\" not in err:\n\t\treturn True\n\telse:\n\t\treturn False  \n\ndef get_f5_version():\n\n\t'''finding F5 version'''\n\tver=db.find({'name':device},{'detailedVersion':1})[0]['detailedVersion']\n\tver=ver.split('.')\n\tver=float((str(ver[0])+'.'+str(ver[1])))\n\treturn ver\n\ndef get_cpu_memory():\n\n\t'''finding CPU Memory'''\n\n\tstdin, stdout, stderr = connection.exec_command(run_util_bash_start_string+\"tmsh show sys cpu | grep Utilization | awk {'print $2'}\"+run_util_bash_end_string)\n\tcpu_mem=stdout.read().decode('utf-8').split('\\n')[0]\n\treturn cpu_mem\n\ndef get_tmm_memory(ver):\n\n\t'''calculating TMM Memory based on version'''\n\n\tif ver>11.5:\n\t\tstdin, stdout, stderr = connection.exec_command(run_util_bash_start_string+\"tmsh show sys memory | grep TMM | awk '{print $4}'\"+run_util_bash_end_string)\n\t\ttmm_mem=stdout.read().decode('utf-8').split('\\n')[0]\n\telif ver<=11.5:\n\t\tstdin, stdout, stderr = connection.exec_command(run_util_bash_start_string+\"tmsh show sys memory | grep Alloc | awk '{print $4}'\"+run_util_bash_end_string)\n\t\ttmm_alloc_mem=stdout.read().decode('utf-8').split('\\n')[0]\n\t\tif tmm_alloc_mem[-1]=='M':\n\t\t\ttmm_alloc_mem=float(tmm_alloc_mem[0:-1])/1024\n\t\telse:\n\t\t\ttmm_alloc_mem=float(tmm_alloc_mem[0:-1])\n\n\t\tstdin, stdout, stderr = connection.exec_command(run_util_bash_start_string+\"tmsh show sys memory | grep Used | awk '{if (NR==3) print $4}'\"+run_util_bash_end_string)\n\t\ttmm_used_mem=stdout.read().decode('utf-8').split('\\n')[0]\n\t\tif tmm_used_mem[-1]=='M':\n\t\t\ttmm_used_mem=float(tmm_used_mem[0:-1])/1024\n\t\telse:\n\t\t\ttmm_used_mem=float(tmm_used_mem[0:-1])\n\t\ttmm_mem=(tmm_used_mem/tmm_alloc_mem)*100\n\t\ttmm_mem=float(\"{0:.2f}\".format(tmm_mem))\n\treturn tmm_mem\n\nif __name__ == '__main__':\n\tconnection = connect_remote(deviceip, uname, pwrd)\n\tbash_mode = check_bash_mode(connection)\n\tif not(bash_mode):\n\t\trun_util_bash_start_string=\"run util bash -c \\\"\"\n\t\trun_util_bash_end_string=\"\\\"\"\n\telse:\n\t\trun_util_bash_start_string=''\n\t\trun_util_bash_end_string=''\n\tver=get_f5_version()\n\tcpu_mem=get_cpu_memory()\n\ttmm_mem=get_tmm_memory(ver)\n\tconnection.close()\n\t\n\toutjson={\"tmm_mem\":tmm_mem,\"cpu_mem\":cpu_mem}\n\tAVX::LOG(\"Cpu Memory : \"+str(cpu_mem)+\"% and TMM Memory : \"+str(tmm_mem)+\"%\")\n\t\n\tAVX::OUTPUT({\"Cpu Memory\" : \"\"+str(cpu_mem)+\"%\" ,\"TMM Memory\" : \"\"+str(tmm_mem)+\"%\"})\n# \tif int(cpu_mem) > cpu_memory_threshold or int(tmm_mem) > tmm_memory_threshold:\n# \t   # AVX::LOG(\"Threshold exceeded\")\n# \t    outjson[\"Status\"] = \"Threshold exceeded\"\n# \t    AVX::OUTPUT(outjson,2)\n# \telse:\n# \t    outjson[\"Status\"] = \"Threshold normal\"\n# \t    AVX::OUTPUT(outjson)\n",
    "http_method" : "POST",
    "action_id" : "run-script"
  }, {
    "uniqueId" : null,
    "directoryUniqueId" : null,
    "source" : null,
    "tags" : [ ],
    "userName" : null,
    "objectType" : "TaskDetails",
    "sourceControlSettings" : null,
    "description" : null,
    "historyReferences" : [ "5dba86d0b5d9460c23e4cd97", "5dba83d3b5d9460c23e4c63b", "5dbacb13b5d9460c23e4fca1", "5dc15586c84657144177dc91", "5dba84c2b5d9460c23e4c8ed", "5dba83d6b5d9460c23e4c65f", "5dba83d8b5d9460c23e4c661", "5dba86d2b5d9460c23e4cdc0", "5f28c049c2b0fb7a76b2f28f", "5dba83b4b5d9460c23e4c5ed", "5dbacb66b5d9460c23e4fcbb", "5f28c046c2b0fb7a76b2f28d", "5dba84bcb5d9460c23e4c8d1" ],
    "usedHistory" : "574400bb0e40c10002c13cf012a8a177",
    "sampleInput" : null,
    "sampleOutput" : null,
    "contentTab" : "",
    "successiveTasks" : {
      "success" : [ {
        "taskId" : "cpu_tmm_check_1",
        "taskName" : null,
        "subflowId" : "YObl0e4R",
        "parentSubflowId" : "",
        "taskType" : "script",
        "flowName" : null,
        "linkType" : null,
        "backwardLink" : false
      } ],
      "incoming" : [ {
        "taskId" : "workflow_start_1",
        "taskName" : null,
        "subflowId" : "YObl0e4R",
        "parentSubflowId" : "",
        "taskType" : "start",
        "flowName" : null,
        "linkType" : null,
        "backwardLink" : false
      } ]
    },
    "flowPathID" : null,
    "ignoredForStatusComputation" : false,
    "flowName" : "",
    "subFlowID" : "YObl0e4R",
    "globalData" : null,
    "input" : [ {
      "name" : null,
      "key" : "schedule_end",
      "value" : "<%schedule_end%>",
      "description" : null,
      "dataType" : "JSON",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "schedule_end",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    }, {
      "name" : null,
      "key" : "schedule_start",
      "value" : "<%schedule_start%>",
      "description" : null,
      "dataType" : "JSON",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "schedule_start",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    } ],
    "notificationMessage" : {
      "0" : "",
      "1" : "",
      "2" : ""
    },
    "ancestor" : null,
    "metaData" : {
      "taskHeader" : "Schedule",
      "hide" : false,
      "lock" : false,
      "successState" : 1,
      "failoverState" : 2,
      "taskScope" : null,
      "hideFromStageView" : false,
      "mode" : "Developer",
      "nature" : "normal",
      "lowCodeTask" : false
    },
    "parentSubFlowID" : "",
    "helpContent" : null,
    "startTime" : "<%schedule_start%>",
    "endTime" : "<%schedule_end%>",
    "scheduleType" : "referenceTime",
    "_id" : null,
    "task_id" : "schedule_1",
    "task_name" : "Schedule",
    "task_type" : "schedule",
    "task_category" : "schedule",
    "component_type" : "others",
    "setNullProperties" : true,
    "folderName" : null,
    "sub_group" : "schedule",
    "group_name" : "General",
    "viewable_type" : "custom"
  } ],
  "subFlowID" : "YObl0e4R",
  "taskGlobalData" : {
    "workflow_stop_1" : [ ],
    "cpu_tmm_check_1" : [ {
      "name" : "cpu_mem",
      "key" : "cpu_mem",
      "value" : "cpu_mem",
      "description" : null,
      "dataType" : "string",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "cpu_mem",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    }, {
      "name" : "tmm_mem",
      "key" : "tmm_mem",
      "value" : "tmm_mem",
      "description" : null,
      "dataType" : "string",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "tmm_mem",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    }, {
      "name" : "Status",
      "key" : "Status",
      "value" : "Status",
      "description" : null,
      "dataType" : "string",
      "size" : 0,
      "variableType" : "global",
      "defaultValues" : null,
      "mandatory" : false,
      "showToolTip" : false,
      "useDefaultValue" : false,
      "variableDeclared" : false,
      "variableUsed" : false,
      "sourceTasks" : null,
      "destinationTasks" : null,
      "enableForIOVariables" : true,
      "order" : 0,
      "label" : "Status",
      "dataValidation" : null,
      "notification" : null,
      "elementType" : null,
      "type" : "Custom",
      "_id" : null
    } ],
    "schedule_1" : [ ]
  },
  "type" : null,
  "level" : 0,
  "maxDepth" : 0,
  "input" : null,
  "workflowName" : "Device_CPU_Memory_UtilizationReport",
  "description" : null,
  "flowName" : null,
  "workflowType" : "Default",
  "subFlowType" : "Default",
  "parentSubFlowID" : null,
  "logs" : [ ],
  "workflowVersion" : "master"
}, {
  "tasks" : [ {
    "uniqueId" : null,
    "directoryUniqueId" : null,
    "source" : null,
    "tags" : [ ],
    "userName" : null,
    "objectType" : "TaskDetails",
    "sourceControlSettings" : null,
    "description" : null,
    "historyReferences" : [ "5d5e470e59d3b8006a2f0d44" ],
    "usedHistory" : "7e9aab4014a3a548b2769e87892d4518",
    "sampleInput" : null,
    "sampleOutput" : null,
    "contentTab" : null,
    "successiveTasks" : { },
    "flowPathID" : null,
    "ignoredForStatusComputation" : true,
    "flowName" : null,
    "subFlowID" : null,
    "globalData" : null,
    "input" : [ ],
    "notificationMessage" : null,
    "ancestor" : null,
    "metaData" : {
      "taskHeader" : "stop",
      "hide" : false,
      "lock" : false,
      "successState" : 1,
      "failoverState" : 2,
      "taskScope" : null,
      "hideFromStageView" : false,
      "mode" : "Developer",
      "nature" : null,
      "lowCodeTask" : false
    },
    "parentSubFlowID" : null,
    "helpContent" : null,
    "rules" : { },
    "cleanUpFlowDetails" : { },
    "subFlowDetails" : [ ],
    "associatedRollbackWorkOrderDetail" : null,
    "_id" : null,
    "task_id" : "workflow_stop_1",
    "task_name" : "Stop",
    "task_type" : "stop",
    "task_category" : "stop",
    "component_type" : "others",
    "setNullProperties" : true,
    "folderName" : null,
    "sub_group" : null,
    "group_name" : null,
    "viewable_type" : "custom"
  } ],
  "subFlowID" : "sw8dXWDJ",
  "taskGlobalData" : {
    "workflow_stop_1" : [ ]
  },
  "type" : null,
  "level" : 0,
  "maxDepth" : 0,
  "input" : null,
  "workflowName" : "Device_CPU_Memory_UtilizationReport",
  "description" : null,
  "flowName" : null,
  "workflowType" : "Rollback",
  "subFlowType" : "Default",
  "parentSubFlowID" : null,
  "logs" : [ ],
  "workflowVersion" : "master"
} ]